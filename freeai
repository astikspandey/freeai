#!/usr/bin/env bash
set -euo pipefail

API_URL="${FREEAI_API_URL:-https://51c5293ab5c4.ngrok-free.app}"

if [[ $# -lt 2 ]]; then
  echo "Usage:"
  echo "  freeai <context_file> <prompt>"
  echo ""
  echo "Set API URL with:"
  echo "  export FREEAI_API_URL=https://your-ngrok-url.ngrok.io"
  exit 1
fi

ctx="$1"
shift
message="$*"

# Read context file if it exists
context_content=""
if [[ -f "$ctx" ]]; then
  context_content="$(cat "$ctx" 2>/dev/null)"
fi

# Call the API directly
curl -sG "$API_URL/run" \
  --data-urlencode "prompt=$message" \
  --data-urlencode "nothink=true" \
  --data-urlencode "model=qwen2.5:3b" \
  --data-urlencode "context=$context_content"

echo ""

